<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>“正则大挑战”心得 | Jim Liu&#39;s Blog</title>
  <meta name="author" content="Jim Liu">
  
  <meta name="description" content="就是它！！！这是昨天在微博上看到的“只要把这16个题做完，你就可以精通正则。”啧啧啧，好奇心驱使我点开了……
然后……真是太好玩了，这是一个正则表达式的游戏，其中有的题目简直丧心病狂，可以说是我做过最难的编程puzzle之一了。
这篇博客将会分享一下我的解答，后来@小雪-Joanna给我发了一个牛人答案（标准答案？）里面我看得懂的也分析一下。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="“正则大挑战”心得"/>
  <meta property="og:site_name" content="Jim Liu&#39;s Blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jim Liu&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jim Liu&#39;s Blog</a></h1>
  <h2><a href="/">Again, Jim Liu&#39;s Blog</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/feedback">Feedback</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft">
      <div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-01-04T12:23:12.000Z"><a href="/2014/01/04/regex-golf/">Jan 4 2014</a></time>
      
      
  
    <h1 class="title">“正则大挑战”心得</h1>
  

    </header>
    <div class="entry">
      
        <p>就是<strong><a href="http://regex.alf.nu/" target="_blank" rel="external">它</a></strong>！！！这是昨天在微博上看到的“只要把这16个题做完，你就可以精通正则。”啧啧啧，好奇心驱使我点开了……</p>
<p>然后……真是太好玩了，这是一个正则表达式的游戏，其中有的题目简直丧心病狂，可以说是我做过最难的编程puzzle之一了。</p>
<p>这篇博客将会分享一下<strong>我的解答</strong>，后来<a href="http://weibo.com/wileam" target="_blank" rel="external">@小雪-Joanna</a>给我发了一个<a href="https://gist.github.com/jonathanmorley/8058871" target="_blank" rel="external">牛人答案（标准答案？）</a>里面我看得懂的也分析一下。</p>
<a id="more"></a>
<h2 id="1-Plain_String">1.Plain String</h2><blockquote>
<p>Type a regex in the box. You get ten points per correct match. Hit Enter to go to the next ‘level’.</p>
</blockquote>
<p>送分题，毫无疑问，答案是<code>foo</code>，<strong>207</strong>分。</p>
<h2 id="2-Anchors">2.Anchors</h2><blockquote>
<p>You are deducted one point per character you use, and ten if you match something you shouldn’t.</p>
</blockquote>
<p>考察对<strong>边界</strong>的应用。最开始我给出的是<code>ick$</code>，后来发现是<code>ck$</code>，最后丧心病狂的发现是<code>k$</code>，得分分别是206, 207, <strong>208</strong>。</p>
<h2 id="3-Ranges">3.Ranges</h2><blockquote>
<p>The test vectors were generated by grepping /usr/dict/words. Can you tell?</p>
</blockquote>
<p>考察对<strong>范围</strong>的应用，同时结合<strong>边界</strong>和<strong>量词</strong>。我的答案是<code>^[a-f]+$</code>，当然<code>^[a-f]*$</code>也是可以的，并且得分一样，都是<strong>202</strong>。</p>
<h2 id="4-Backrefs">4.Backrefs</h2><blockquote>
<p>This doesn’t really work as a tutorial. Not really clear what you’re supposed to do here.</p>
</blockquote>
<p>从题面上看，是考察对于<strong>反向引用</strong>的使用。我给的答案是<code>(.{3,}).*\1</code>，得分是<strong>199</strong>，找了很久没有发现优化空间，直到我看了牛人解答之后，竟然给出了<code>(...).*\1</code>，我真蠢。</p>
<h2 id="阶段性小结">阶段性小结</h2><p>毫无疑问前4关是比较简单的，其中前3关都是正则中会用到的基本用法，第4关只要是比较熟练的同学也肯定是会的，能否拿高分差别在于够不够省。</p>
<h2 id="5-Abba">5.Abba</h2><blockquote>
<p>Let’s pretend this one is not a rehash of the last one.</p>
</blockquote>
<p>说实话这个题目相当具有迷惑性，也挺有难度，微博上看的确有不少同学卡在这题上了。</p>
<p>观察题面，要求<strong>不匹配</strong>字符串内含形如<code>abba</code>组合的串，首先可以简单地使用反向引用构造出<code>(.)(.)\2\1</code>。</p>
<p>有了它后，怎么做到<strong>不匹配</strong>呢？这里要用到<strong>负向前瞻</strong>，负向前瞻是<strong>零宽断言</strong>的一种，JavaScript中的负向前瞻形如<code>(?!exp)</code>，匹配后面不是exp的串。</p>
<p>OK，下面一步步构造，首先用<code>(?!(.)(.)\2\1)</code>试试，发现左边的都匹配上了，右边的……也匹配上了- -|。然后用一个很损的办法，<code>^(?!(.)(.)\2\1)</code>，右边干掉了2个。</p>
<p>这时候其实回想一下题目，我们要排除的是形如<code>****abba****</code>的串，那么在刚才的基础上加上<code>^(?!.*(.)(.)\2\1.*)</code>，对了！191分。</p>
<p>再仔细想一下，对abba再后面的串其实没必要再限制了，优化到<code>^(?!.*(.)(.)\2\1)</code>，<strong>193</strong>分。</p>
<p>JavaScript的正则只支持<strong>前瞻</strong>(Look Ahead)而不支持<strong>后瞻</strong>(Look Behind)，也就是说我们只能“用右边的东西限制当前位置”。</p>
<h2 id="6-A_man,_a_plan">6.A man, a plan</h2><blockquote>
<p>You’re allowed to cheat a little, since this one is technically impossible.</p>
</blockquote>
<p>对称串嗯哼？有了前面的经验这题不会很难的，我构造了半天，中间也经过几次升级，结果用了<code>(.)(.).?\2\1.?$</code>，得分是<strong>175</strong>。</p>
<p>牛X答案给的是<code>^(.)[^p].*\1$</code>，我只想说这东西相当牛X，而且很符合题目描述<em>cheat a little</em>，它能拿到177分。</p>
<h2 id="7-Prime">7.Prime</h2><blockquote>
<p>The length is not part of the string. I should probably have chosen a different color.</p>
</blockquote>
<p>非常非常好玩的一道题，要不是我曾经看过<a href="http://www.matrix67.com/blog/archives/475" target="_blank" rel="external">M67的一篇博客</a>知道正则有<strong>判断素数</strong>这种神奇的用法，这道题简直无从下手。</p>
<p>首先用<code>^x?$|^(xx+?)\1+$</code>判断长度是合数，因为没有长为0或1的，所以直接精简到<code>^(xx+?)\1+$</code>，nice！错误答案全部匹配，正确答案全部不匹配。</p>
<p>有了上面的经验，剩下的不会有什么难度了，<code>^(?!(xx+?)\1+$)</code>，<strong>285</strong>分到手。而牛人答案<code>^(?!(..+)\1+$)</code>中却没有对中间的<code>xx+?</code>启用非贪婪，达到286分，这个因为我不怎么看得懂这个素数匹配的原理，所以我也不再妄加评判了……</p>
<h2 id="8-Four">8.Four</h2><blockquote>
<p>You can get an extra point by ignoring the name of this level.</p>
</blockquote>
<p>观察题面，它要匹配的其实是形如<code>*a*a*a*a</code>或者是<code>a*a*a*a*</code>，按照这个思路，可以构造出<code>.(.)(?:.\1){3,}|(.).(?:\2.){3,}</code>，这样已经可以拿到179分了。</p>
<p>其实进一步观察，不难发现其实形态1中的开头和形态2中的结尾是并不重要的，所以我们想要的其实只是<code>a*a*a</code>而已，那么<code>(.)(.\1){3}</code>就可以完美解决了，并且能够得到<strong>199</strong>分。</p>
<h2 id="阶段性小结-1">阶段性小结</h2><p>5~8题开始有点没节操了，但至少还是在技术技巧的范围内的，第7题天马行空，报酬也丰厚。</p>
<p>事实上我从9题开始就胡诌了。</p>
<h2 id="9-Order">9.Order</h2><blockquote>
<p>Cheat.</p>
</blockquote>
<p>描述一点也不含蓄，看题面，发现需要匹配的是<strong>非降序</strong>的串。</p>
<p>然后我实在是不会了，我本来天真的以为<code>(.)[\1-z]</code>中的范围表达式是可以利用反向引用的，结果当然是不行。于是我随便写了个<code>^a[b-z]+$</code>，惨淡地得了<strong>41</strong>分。</p>
<p>然后看了牛人解答我哭了，<code>^.{5}[^e]?$</code>，果然是cheat，当然也不得不佩服这观察力，199分。</p>
<h2 id="10-Triples">10.Triples</h2><blockquote>
<p>Multiples of 7 are left as an exercise for the reader.</p>
</blockquote>
<p>题面很简单，就是<strong>能被3整除</strong>。搜索了一下，有能构造<strong>匹配能被3整除的2进制数</strong>的办法，但是这里是10进制。于是胡诌继续，<code>00</code>就这么搞上去，也能<strong>118</strong>分你敢信？</p>
<p>答案是<code>00($|3|6|9|12|15)|4.2|.1.+4|55|.17</code>，满分达到了596分。我觉着这货跟数学没啥关系，就是靠观察力硬凑……</p>
<h2 id="11-Glob">11.Glob</h2><p>题面非常有意思，要构造一个<code>xxx matches yyy</code>这种，也就是matches的前面充当正则的时候能匹配后面的串。</p>
<p>当然如果往这个方向想，那就肯定做不出来的（好残酷），当我看到答案的时候，我吓尿了：<code>ai|c$|^p|[bcnrw][bnopr]</code>这要有多强大的观察力才能做出来。</p>
<p>我的答案<code>\*</code>，<strong>58</strong>分惨淡收场。</p>
<h2 id="12-Balance">12.Balance</h2><blockquote>
<p>This one is also impossible, but there’s a finite number of test cases.</p>
</blockquote>
<p>描述都说impossible，当场吓尿。你猜我给的是什么？说出来吓死你：<code>^$</code>，得分<strong>8</strong>也吓死你……</p>
<p><a href="http://weibo.com/11978569" target="_blank" rel="external">@Thomas</a>凭借<code>&lt;&lt;&lt;&lt;</code>得到了146分，我佩服他想象力！</p>
<p>牛人答案是<code>^(&lt;(&lt;(&lt;(..)*&gt;)*&gt;)*&gt;)*$</code>得分288，<strong>但这依然并不是完美答案</strong>。</p>
<p>括号配对对于正则是一个非常大的难题，因为<a href="http://zh.wikipedia.org/wiki/%E6%AD%A3%E5%88%99%E6%96%87%E6%B3%95" target="_blank" rel="external">正则文法</a>的定义先天就不是递归的。我们现在用的加强的正则表达式，尽管加入了反向引用、计数、前瞻后瞻等高级功能，但我理解它的数学定义并没有超过这个范畴，而是在实现引擎层面上新增的功能。</p>
<p>但其实正则来处理括号配对不是不可能的，C#标准库的正则是支持<a href="http://msdn.microsoft.com/zh-cn/library/bs2twtah.aspx#balancing_group_definition" target="_blank" rel="external">平衡组</a>的，我也没有实际用过，就不深入聊这个了。</p>
<h2 id="阶段性小结-2">阶段性小结</h2><p>9~12题是相当丧心病狂，不“作弊”基本没法正常做了。而且后面的题目作者好像已经完全懒得写描述了。</p>
<h2 id="13-Powers">13.Powers</h2><p>从题目名字看，就是<strong>幂</strong>（我不是要说杨幂）。</p>
<p>付出了把键盘敲烂的代价，我丧心病狂地写出了<code>^((((((((((x)\10?)\9?)\8?)\7?)\6?)\5?)\4?)\3?)\2?)\1?$</code>，虽然是完美匹配，但估计是因为表达式太长，只得了<strong>56</strong>分。</p>
<p>牛人答案是<code>^(?!(.(..)+)\1*$)</code>，这个很有意思，我们来解读一下。</p>
<p>首先我只看到了正确答案是<strong>长度为2的整数次幂的串</strong>，而没有观察错误答案，这不得不说是一个重大失误！</p>
<p>错误答案中比较短的几个，长度是3,5,7,11,13的串，可以表示为<code>2n+1</code>，那么可以先构造出<code>^(.(xx)+)$</code>，发现还匹配了401和1025。</p>
<p>那么，长度为28,48,160,600的呢？把他们做因数分解，发现28=7*2*2, 48=3*2*2*2*2, 160=5*2*2*2*2*2, 600=75*2*2*2，也就是说他们都是<code>(2n+1)*pow(2, m)</code>的形态。于是在上面的基础上构造出来<code>^(.(xx)+)\1*$</code>，能够成功匹配所有错误答案了！</p>
<p>结合第7题中的狗血方法，稍作修改就得到<code>^(?!(.(..)+)\1*$)</code>这个答案，其实也不过才93分而已嘛……当然不看答案的话我也真心找不到这规律。</p>
<h2 id="14-Long_Count">14.Long Count</h2><p>我会告诉你我直接把左边的那串数字拿来用了吗？<strong>191</strong>分。</p>
<p>答案是<code>^((.+)0 \2+1 ?)*$</code>仔细看看应该能明白，还是凭借细心的观察，这样可以拿到253分。</p>
<h2 id="15-Long_Count_v2">15.Long Count v2</h2><p>我会告诉你我<del>又</del>直接把左边的那串数字拿来用了吗？<strong>191</strong>分。</p>
<p>答案<del>又</del>是<code>^((.+)0 \2+1 ?)*$</code>，这样<del>又</del>可以拿到253分。我根本没观察跟14题有啥区别，所以不评论了。</p>
<h2 id="16-Alphabetical">16.Alphabetical</h2><p>毫无头绪的一题，<code>aerate</code>骗到<strong>33</strong>分，好累，感觉不会再爱了。</p>
<p>答案是<code>.r.{32}r|a.{10}te|n.n..</code>，317分，我的建议是不要试图解读它。</p>
<h2 id="难忘今宵">难忘今宵</h2><p>我的总分是<strong>2364</strong>分，相比于能刷上3000分的大神们，结合文章开头的话“只要把这16个题做完，你就可以精通正则。”我现在只能说</p>
<blockquote>
<p>我根本不会正则啊！！！</p>
</blockquote>
<p>如果你看到了这里，说明你也刚刚经历了一场惨痛的折磨，对此我深表同情。</p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/编程/">编程</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<!-- Duoshuo Comment BEGIN -->
<div id="comments" class="ds-thread" data-title="“正则大挑战”心得" data-url="http://jimliu.net/2014/01/04/regex-golf/"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"jimliu-net"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- Duoshuo Comment END -->

</div>
    </div>
    <aside id="sidebar" class="alignright">
  
<div class="widget about_me">
  <h3 class="title">ABOUT JIM</h3>
  <ul class="entry">
    
    <li><img width="150" title="avatar" src="/uploads/2012/03/Pig.180x180-150x150.jpg" /></li>
    
    
    <li><a href="/about">刘骥</a></li>
    
    <li>微博：<a href="http://weibo.com/jimnox" target="_BLANK">@刘骥-JimLiu</a></li>
    
    <li>知乎：<a href="http://www.zhihu.com/people/jimnox" target="_BLANK">@Jim Liu</a></li>
    
    <li>旧博客：<a href="http://jimnox.cnblogs.com/" target="_BLANK">博客园</a></li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/影像/">影像</a><small>2</small></li>
  
    <li><a href="/tags/未分类/">未分类</a><small>1</small></li>
  
    <li><a href="/tags/生活/">生活</a><small>5</small></li>
  
    <li><a href="/tags/站着说话不腰疼/">站着说话不腰疼</a><small>9</small></li>
  
    <li><a href="/tags/编程/">编程</a><small>41</small></li>
  
    <li><a href="/tags/音乐/">音乐</a><small>3</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/10/22/real-functional-programming-in-javascript-1/">使用JavaScript实现“真·函数式编程”</a>
      </li>
    
      <li>
        <a href="/2015/10/15/functional-reverse-in-es6/">ES6实现递归reverse函数的新装逼技巧</a>
      </li>
    
      <li>
        <a href="/2015/10/14/curry-function-in-es6/">ES6实现Curry函数的新装逼技巧</a>
      </li>
    
      <li>
        <a href="/2015/10/10/beginning-swift-3/">Swift入门笔记-3</a>
      </li>
    
      <li>
        <a href="/2015/10/09/beginning-swift-2/">Swift入门笔记-2</a>
      </li>
    
  </ul>
</div>


  
<div class="widget duoshuo_recent_comments">
  <h3 class="title">最新评论</h3>
  <ul class="entry ds-recent-comments" data-num-items="5" data-show-avatars="0" data-show-title="1" data-show-time="1"></ul>
</div>
<!--多说js加载开始，一个页面只需要加载一次 -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"jimliu-net"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!--多说js加载结束，一个页面只需要加载一次 -->


  
<div class="widget links">
  <h3 class="title">链接</h3>
  <ul class="entry">
    
    <li><a href="http://diaorui.net/" target="_BLANK">Dora Blog</a></li>
    
    <li><a href="http://blog.sina.com.cn/s/blog_66783fc50101bzjy.html?from=jimlius_blog" target="_BLANK">ETPHOTOS的影像博客</a></li>
    
    <li><a href="http://licstar.net/?from=jimlius_blog" target="_BLANK">licstar的博客</a></li>
    
    <li><a href="http://odinliu.com/?from=jimlius_blog" target="_BLANK">Odin的自我修养</a></li>
    
    <li><a href="http://yulijia.net/cn/" target="_BLANK">Lijia Yu&#39;s Website</a></li>
    
    <li><a href="http://www.xperseverance.net/" target="_BLANK">持之以恒</a></li>
    
    <li><a href="http://code.wileam.com/?from=jimlius_blog" target="_BLANK">Joanna&#39;s coding blog</a></li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Jim Liu
  
</div>
<div class="clearfix"></div></footer>
  <script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div style="display:none;">
  <script type="text/javascript">
  var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
  document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F747d6706c57a3ead8dc1f78ce3e72866' type='text/javascript'%3E%3C/script%3E"));
  </script>
</div>
</body>
</html>
